{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/hooks/useUserRole.ts"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from 'react';\r\nimport { useAuth } from '../context/authContext';\r\n\r\n// Hook para obtener el rol del usuario desde la API interna (PostgreSQL)\r\nexport function useUserRole() {\r\n  const { user } = useAuth();\r\n  const [role, setRole] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (!user) {\r\n      setRole(null);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n    // Llama a tu API interna para obtener el rol por UID de Firebase\r\n    const fetchRole = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const res = await fetch(`/api/user-role?uid=${user.uid}`);\r\n        const data = await res.json();\r\n        setRole(data.role || null);\r\n      } catch (err) {\r\n        setRole(null);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchRole();\r\n  }, [user]);\r\n\r\n  return { role, loading };\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;AAKO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,yIAAO;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAgB;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,MAAM;YACT,QAAQ;YACR,WAAW;YACX;QACF;QACA,iEAAiE;QACjE,MAAM,YAAY;YAChB,WAAW;YACX,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,KAAK,GAAG,EAAE;gBACxD,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,QAAQ,KAAK,IAAI,IAAI;YACvB,EAAE,OAAO,KAAK;gBACZ,QAAQ;YACV,SAAU;gBACR,WAAW;YACb;QACF;QACA;IACF,GAAG;QAAC;KAAK;IAET,OAAO;QAAE;QAAM;IAAQ;AACzB","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/components/ProtectedRoute.tsx"],"sourcesContent":["\"use client\";\r\nimport React from 'react';\r\nimport { useAuth } from '../context/authContext';\r\nimport { useUserRole } from '../hooks/useUserRole';\r\n\r\n// Componente para proteger rutas según autenticación y rol\r\nexport default function ProtectedRoute({ children, allowedRoles }: { children: React.ReactNode, allowedRoles?: string[] }) {\r\n  const { user, loading: authLoading } = useAuth();\r\n  const { role, loading: roleLoading } = useUserRole();\r\n\r\n  if (authLoading || roleLoading) return <div>Cargando...</div>;\r\n  if (!user) {\r\n    if (typeof window !== 'undefined') {\r\n      window.location.href = '/login';\r\n    }\r\n    return null;\r\n  }\r\n\r\n  if (allowedRoles && (!role || !allowedRoles.includes(role))) {\r\n    return <div>No tienes permiso para acceder a esta página.</div>;\r\n  }\r\n\r\n  return <>{children}</>;\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAMe,SAAS,eAAe,EAAE,QAAQ,EAAE,YAAY,EAA0D;IACvH,MAAM,EAAE,IAAI,EAAE,SAAS,WAAW,EAAE,GAAG,IAAA,yIAAO;IAC9C,MAAM,EAAE,IAAI,EAAE,SAAS,WAAW,EAAE,GAAG,IAAA,0IAAW;IAElD,IAAI,eAAe,aAAa,qBAAO,8OAAC;kBAAI;;;;;;IAC5C,IAAI,CAAC,MAAM;QACT;;QAGA,OAAO;IACT;IAEA,IAAI,gBAAgB,CAAC,CAAC,QAAQ,CAAC,aAAa,QAAQ,CAAC,KAAK,GAAG;QAC3D,qBAAO,8OAAC;sBAAI;;;;;;IACd;IAEA,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/styles/admin-dashboard.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"activityAction\": \"admin-dashboard-module__5BnUYq__activityAction\",\n  \"activityCard\": \"admin-dashboard-module__5BnUYq__activityCard\",\n  \"activityDate\": \"admin-dashboard-module__5BnUYq__activityDate\",\n  \"activityTable\": \"admin-dashboard-module__5BnUYq__activityTable\",\n  \"activityTitle\": \"admin-dashboard-module__5BnUYq__activityTitle\",\n  \"activityUser\": \"admin-dashboard-module__5BnUYq__activityUser\",\n  \"avatar\": \"admin-dashboard-module__5BnUYq__avatar\",\n  \"dashboardContainer\": \"admin-dashboard-module__5BnUYq__dashboardContainer\",\n  \"logo\": \"admin-dashboard-module__5BnUYq__logo\",\n  \"logoutBtn\": \"admin-dashboard-module__5BnUYq__logoutBtn\",\n  \"mainContent\": \"admin-dashboard-module__5BnUYq__mainContent\",\n  \"menu\": \"admin-dashboard-module__5BnUYq__menu\",\n  \"menuItem\": \"admin-dashboard-module__5BnUYq__menuItem\",\n  \"menuItemActive\": \"admin-dashboard-module__5BnUYq__menuItemActive\",\n  \"metricCard\": \"admin-dashboard-module__5BnUYq__metricCard\",\n  \"metricLabel\": \"admin-dashboard-module__5BnUYq__metricLabel\",\n  \"metricValue\": \"admin-dashboard-module__5BnUYq__metricValue\",\n  \"metricsGrid\": \"admin-dashboard-module__5BnUYq__metricsGrid\",\n  \"sidebar\": \"admin-dashboard-module__5BnUYq__sidebar\",\n  \"subtitle\": \"admin-dashboard-module__5BnUYq__subtitle\",\n  \"title\": \"admin-dashboard-module__5BnUYq__title\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/components/NextLink.tsx"],"sourcesContent":["import Link from 'next/link';\r\n\r\nexport default Link;"],"names":[],"mappings":";;;;AAAA;;uCAEe,uKAAI","debugId":null}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/app/admin/usuarios/listado/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport ProtectedRoute from \"../../../../components/ProtectedRoute\";\r\nimport styles from \"../../../../styles/admin-dashboard.module.css\";\r\nimport formStyles from \"../../../../styles/admin-user-form.module.css\";\r\nimport NextLink from \"../../../../components/NextLink\";\r\n\r\nfunction BackToDashboardButton() {\r\n  return (\r\n    <div style={{ marginBottom: 24 }}>\r\n      <NextLink href=\"/admin\" style={{ display: 'inline-flex', alignItems: 'center', gap: 8, color: '#2563eb', fontWeight: 500 }}>\r\n        <svg width=\"20\" height=\"20\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 19l-7-7 7-7\"/></svg>\r\n        Volver al Dashboard\r\n      </NextLink>\r\n    </div>\r\n  );\r\n}\r\n\r\ntype User = {\r\n  id: number;\r\n  name: string | null;\r\n  email: string;\r\n  role: string;\r\n  documentType?: string;\r\n  documentNumber?: string;\r\n  birthDate?: string;\r\n  phone?: string;\r\n  address?: string;\r\n  gender?: string;\r\n  photoUrl?: string;\r\n  firebaseUid?: string;\r\n  active: boolean;\r\n};\r\n\r\nexport default function ListadoUsuariosPage() {\r\n  const [users, setUsers] = useState<User[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    fetch(\"/api/admin/usuarios\")\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        setUsers(data);\r\n        setLoading(false);\r\n      })\r\n      .catch(() => {\r\n        setError(\"Error al cargar usuarios\");\r\n        setLoading(false);\r\n      });\r\n  }, []);\r\n\r\n  const handleEdit = (user: User) => {\r\n    // Aquí puedes redirigir o abrir modal de edición\r\n    alert(`Editar usuario: ${user.name}`);\r\n  };\r\n\r\n  const handleToggleActive = async (user: User) => {\r\n    try {\r\n      const res = await fetch(\"/api/admin/usuarios\", {\r\n        method: \"PUT\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ id: user.id, active: !user.active })\r\n      });\r\n      if (res.ok) {\r\n        setUsers(prev => prev.map(u => u.id === user.id ? { ...u, active: !u.active } : u));\r\n      } else {\r\n        setError(\"No se pudo cambiar el estado\");\r\n      }\r\n    } catch {\r\n      setError(\"No se pudo cambiar el estado\");\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (user: User) => {\r\n    if (!window.confirm(\"¿Seguro que deseas eliminar este usuario?\")) return;\r\n    try {\r\n      const res = await fetch(\"/api/admin/usuarios\", {\r\n        method: \"DELETE\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ id: user.id })\r\n      });\r\n      if (res.ok) {\r\n        setUsers(prev => prev.filter(u => u.id !== user.id));\r\n      } else {\r\n        setError(\"No se pudo eliminar el usuario\");\r\n      }\r\n    } catch {\r\n      setError(\"No se pudo eliminar el usuario\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ProtectedRoute allowedRoles={[\"ADMIN\"]}>\r\n      <div className={styles.dashboardContainer}>\r\n        <aside className={styles.sidebar}>\r\n          <div style={{ display: 'flex', alignItems: 'center', marginBottom: '3rem' }}>\r\n            <img src=\"/favicon.ico\" alt=\"Admin\" className={styles.avatar} />\r\n            <span className={styles.logo}>AulaUnida</span>\r\n          </div>\r\n          <nav className={styles.menu}>\r\n            <ul style={{ listStyle: 'none', padding: 0, margin: 0 }}>\r\n              <li>\r\n                <NextLink href=\"/admin/usuarios\" className={styles.menuItem}>Crear Usuario</NextLink>\r\n              </li>\r\n              <li>\r\n                <NextLink href=\"/admin/usuarios/listado\" className={styles.menuItem + ' ' + styles.menuItemActive}>Listado de usuarios</NextLink>\r\n              </li>\r\n              <li>\r\n                <NextLink href=\"/admin/grados\" className={styles.menuItem}>Grados/Secciones</NextLink>\r\n              </li>\r\n              <li>\r\n                <NextLink href=\"/admin/matricula\" className={styles.menuItem}>Matrícula</NextLink>\r\n              </li>\r\n            </ul>\r\n          </nav>\r\n        </aside>\r\n        <main className={styles.mainContent}>\r\n          <BackToDashboardButton />\r\n          <h1 className={styles.title}>Listado de Usuarios</h1>\r\n          <div className={styles.activityCard}>\r\n            {error && <div style={{ color: 'red', marginBottom: 12 }}>{error}</div>}\r\n            {loading ? (\r\n              <div style={{ color: '#B0B3B8' }}>Cargando usuarios...</div>\r\n            ) : (\r\n              <table className={styles.activityTable}>\r\n                <thead>\r\n                  <tr>\r\n                    <th>Nombre</th>\r\n                    <th>Correo</th>\r\n                    <th>Rol</th>\r\n                    <th>Activo</th>\r\n                    <th>Acciones</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {users.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan={5} style={{ color: '#B0B3B8' }}>(sin datos)</td>\r\n                    </tr>\r\n                  ) : (\r\n                    users.map(user => (\r\n                      <tr key={user.id}>\r\n                        <td>{user.name || '-'}</td>\r\n                        <td>{user.email}</td>\r\n                        <td>{user.role}</td>\r\n                        <td>\r\n                          <button onClick={() => handleToggleActive(user)} style={{ background: user.active ? '#22c55e' : '#dc2626', color: '#fff', border: 'none', borderRadius: 4, padding: '2px 10px', cursor: 'pointer' }}>\r\n                            {user.active ? 'Activo' : 'Inactivo'}\r\n                          </button>\r\n                        </td>\r\n                        <td>\r\n                          <button onClick={() => handleEdit(user)} style={{ color: '#2563eb', textDecoration: 'underline', marginRight: 12 }}>Editar</button>\r\n                          <button onClick={() => handleDelete(user)} style={{ color: '#dc2626', textDecoration: 'underline' }}>Eliminar</button>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </div>\r\n        </main>\r\n      </div>\r\n    </ProtectedRoute>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}