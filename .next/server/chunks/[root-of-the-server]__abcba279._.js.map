{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/lib/firebaseAdmin.ts"],"sourcesContent":["import { initializeApp, getApps, cert } from 'firebase-admin/app';\r\n\r\nexport function initFirebaseAdmin() {\r\n  // DEBUG: Mostrar las variables de entorno de Firebase\r\n  console.log('FIREBASE_PROJECT_ID:', process.env.FIREBASE_PROJECT_ID);\r\n  console.log('FIREBASE_CLIENT_EMAIL:', process.env.FIREBASE_CLIENT_EMAIL);\r\n  console.log('FIREBASE_PRIVATE_KEY:', process.env.FIREBASE_PRIVATE_KEY ? '[PRESENTE]' : '[NO PRESENTE]');\r\n\r\n  if (!getApps().length) {\r\n    initializeApp({\r\n      credential: cert({\r\n        projectId: process.env.FIREBASE_PROJECT_ID,\r\n        clientEmail: process.env.FIREBASE_CLIENT_EMAIL,\r\n        privateKey: process.env.FIREBASE_PRIVATE_KEY?.replace(/\\n/g, '\\n'),\r\n      }),\r\n    });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEO,SAAS;IACd,sDAAsD;IACtD,QAAQ,GAAG,CAAC,wBAAwB,QAAQ,GAAG,CAAC,mBAAmB;IACnE,QAAQ,GAAG,CAAC,0BAA0B,QAAQ,GAAG,CAAC,qBAAqB;IACvE,QAAQ,GAAG,CAAC,yBAAyB,QAAQ,GAAG,CAAC,oBAAoB,GAAG,eAAe;IAEvF,IAAI,CAAC,IAAA,2JAAO,IAAG,MAAM,EAAE;QACrB,IAAA,iKAAa,EAAC;YACZ,YAAY,IAAA,wJAAI,EAAC;gBACf,WAAW,QAAQ,GAAG,CAAC,mBAAmB;gBAC1C,aAAa,QAAQ,GAAG,CAAC,qBAAqB;gBAC9C,YAAY,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,OAAO;YAC/D;QACF;IACF;AACF","debugId":null}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/lib/prisma.ts"],"sourcesContent":["\r\n// DEBUG: Mostrar el valor de la variable de entorno DATABASE_URL\r\nconsole.log('DATABASE_URL en tiempo de ejecución:', process.env.DATABASE_URL);\r\n\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;"],"names":[],"mappings":"AACA,iEAAiE;;;;;AAGjE;AAFA,QAAQ,GAAG,CAAC,wCAAwC,QAAQ,GAAG,CAAC,YAAY;;AAI5E,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY;AAElB,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/juant/Documents/proyectoCUN/aulaunida/src/app/api/docente/estudiantes/route.ts"],"sourcesContent":["\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getAuth } from 'firebase-admin/auth';\r\nimport { initFirebaseAdmin } from '@/lib/firebaseAdmin';\r\nimport { prisma } from '../../../../lib/prisma';\r\n\r\ninitFirebaseAdmin();\r\n\r\n// GET: Devuelve los estudiantes de un grado/asignatura si el docente tiene esa asignación\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const authHeader = req.headers.get('authorization');\r\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n      return NextResponse.json({ error: 'No autorizado (token faltante)' }, { status: 401 });\r\n    }\r\n    const idToken = authHeader.replace('Bearer ', '');\r\n    const decoded = await getAuth().verifyIdToken(idToken);\r\n    // Busca el usuario en la base de datos y verifica el rol\r\n    const user = await prisma.user.findUnique({\r\n      where: { firebaseUid: decoded.uid },\r\n      select: { id: true, email: true, role: true },\r\n    });\r\n    if (!user || user.role !== 'DOCENTE') {\r\n      return NextResponse.json({ error: 'No autorizado (solo docente)' }, { status: 403 });\r\n    }\r\n    const docenteId = user.id;\r\n    const { searchParams } = new URL(req.url);\r\n    const gradoId = Number(searchParams.get('gradoId'));\r\n    const materiaId = Number(searchParams.get('materiaId'));\r\n    if (!gradoId || !materiaId) {\r\n      return NextResponse.json({ error: 'Faltan parámetros' }, { status: 400 });\r\n    }\r\n    // Validar asignación: buscar MateriaGrado y luego MateriaGradoDocente\r\n    const materiaGrado = await prisma.materiaGrado.findFirst({\r\n      where: { gradoId, materiaId },\r\n    });\r\n    if (!materiaGrado) {\r\n      return NextResponse.json({ error: 'No existe esa asignación grado/materia' }, { status: 404 });\r\n    }\r\n    const asignacion = await prisma.materiaGradoDocente.findFirst({\r\n      where: { docenteId, materiaGradoId: materiaGrado.id },\r\n    });\r\n    if (!asignacion) {\r\n      return NextResponse.json({ error: 'No autorizado para este grupo/materia' }, { status: 403 });\r\n    }\r\n    // Buscar estudiantes matriculados en el grado\r\n    const estudiantes = await prisma.gradoEstudiante.findMany({\r\n      where: { gradoId },\r\n      include: { \r\n        estudiante: {\r\n          include: {\r\n            notasMateriaPeriodo: {\r\n              where: { materiaId },\r\n              include: {\r\n                periodo: true\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n    });\r\n\r\n    // Calcular promedio acumulado para cada estudiante\r\n    const estudiantesConPromedio = estudiantes.map((ge: any) => {\r\n      const estudiante = ge.estudiante;\r\n      const todasLasNotas = estudiante.notasMateriaPeriodo;\r\n      \r\n      // Agrupar notas por período\r\n      const notasPorPeriodo = todasLasNotas.reduce((acc: any, nota: any) => {\r\n        if (!acc[nota.periodo.id]) {\r\n          acc[nota.periodo.id] = {\r\n            periodo: nota.periodo,\r\n            notas: []\r\n          };\r\n        }\r\n        acc[nota.periodo.id].notas.push(nota);\r\n        return acc;\r\n      }, {});\r\n\r\n      // Calcular promedio por período y luego promedio general\r\n      let sumaPromediosPeriodos = 0;\r\n      let periodosConNotas = 0;\r\n\r\n      Object.values(notasPorPeriodo).forEach((periodoData: any) => {\r\n        const notasDelPeriodo = periodoData.notas;\r\n        if (notasDelPeriodo.length > 0) {\r\n          const promedioPeriodo = notasDelPeriodo.reduce((sum: number, nota: any) => sum + nota.valor, 0) / notasDelPeriodo.length;\r\n          sumaPromediosPeriodos += promedioPeriodo;\r\n          periodosConNotas++;\r\n        }\r\n      });\r\n\r\n      const promedioGeneral = periodosConNotas > 0 ? sumaPromediosPeriodos / periodosConNotas : 0;\r\n      \r\n      return {\r\n        id: estudiante.id,\r\n        name: estudiante.name,\r\n        email: estudiante.email,\r\n        notasPorPeriodo: notasPorPeriodo,\r\n        promedio: Number(promedioGeneral.toFixed(2)),\r\n        totalNotas: todasLasNotas.length,\r\n        periodosConNotas: periodosConNotas\r\n      };\r\n    });\r\n\r\n    return NextResponse.json(estudiantesConPromedio);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'No autorizado (token inválido)' }, { status: 401 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}